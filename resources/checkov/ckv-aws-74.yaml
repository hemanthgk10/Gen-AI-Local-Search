---
category: Storage
checkTool: checkov
checkType: CloudFormation
compliance: []
description: "Ensure AWS DocumentDB is encrypted at rest. Amazon DocumentDB uses the 256-bit Advanced Encryption Standard (AES-256) to encrypt your data using encryption keys stored in AWS Key Management Service (AWS KMS). Storage encryption is enabled cluster-wide and is applied to all instances, including the primary instance and any replicas."
extra:
  entity: "AWS::DocDB::DBCluster"
  type: resource
guidelines: |-
    #### Description
    Ensure AWS DocumentDB is encrypted at rest. Amazon DocumentDB uses the 256-bit Advanced Encryption Standard (AES-256) to encrypt your data using encryption keys stored in AWS Key Management Service (AWS KMS). Storage encryption is enabled cluster-wide and is applied to all instances, including the primary instance and any replicas.

    #### Rationale
    Ensure that AWS DocumentDB is encrypted at rest for data security and in order to meet compliance requirements. The encrypted data includes your DocumentDB cluster's data, indexes, logs, replicas and snapshots. AWS handles data encryption and decryption transparently with minimal impact on DB performance.

    #### Remediation
    Set the `storage_encrypted` argument to `true` and provide `kms_key_id` for encryption.

    Terraform example:
    ```
    resource "aws_docdb_cluster" "docdb" {
        cluster_identifier      = "my-docdb-cluster"
        engine                  = "docdb"
        master_username         = "foo"
        master_password         = "mustbeeightchars"
        backup_retention_period = 5
        preferred_backup_window = "07:00-09:00"
        skip_final_snapshot     = true
    +   storage_encrypted       = true
    +   kms_key_id              = "arn:aws:kms:us-west-2:111122223333:key/example"
        ...
        ...
    }
    ```

    CloudFormation example:
    ```
    {
        "Type" : "AWS::DocDB::DBCluster",
        "Properties" : {
            "BackupRetentionPeriod" : 5,
            "CopyTagsToSnapshot" : true,
            "DeletionProtection" : true,
    +       "KmsKeyId" : "arn:aws:kms:us-west-2:111122223333:key/example",
            "MasterUsername" : "admin",
            "MasterUserPassword" : "password",
    +       "StorageEncrypted" : true,
            ...
            ...
        }
    }
    ```

    #### References
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#storage_encrypted
    * https://docs.aws.amazon.com/documentdb/latest/developerguide/encryption-at-rest.html
    * https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-docdb-dbcluster.html#cfn-docdb-dbcluster-storageencrypted
lwid: []
provider: AWS
ruleId: CKV_AWS_74
severity: High
sid: ckv-aws-74
title: "Ensure AWS DocumentDB is encrypted at rest"
autofix: true
remediation:
- checkType: Terraform
  steps:
  - action: add
    resource: [ "resource" ]
    resourceAttribute: storage_encrypted
    resourceAttributeType: boolean
    resourceAttributeValue: "true"
    resourceType: [ "aws_docdb_cluster" ]
  - action: add
    resource: [ "resource" ]
    resourceAttribute: kms_key_id
    resourceAttributeType: string
    resourceAttributeValue: "<Please provide a KMS key ID>"
    resourceType: [ "aws_docdb_cluster" ]
