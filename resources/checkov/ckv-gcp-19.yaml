category: Security
checkTool: checkov
checkType: Terraform
compliance:
- CIS
description: Basic authentication allows a user to authenticate to the cluster with
  a username and password and it is stored in plain text without any encryption. Disabling
  Basic authentication will prevent attacks like brute force. Its recommended to use
  either client certificate or IAM for authentication.
extra:
  entity: google_container_cluster
  type: resource
guidelines: |-
  #### Description
  Basic authentication allows a user to authenticate to the cluster with a username and password and it is stored in plain text without any encryption. Disabling Basic authentication will prevent attacks like brute force. Its recommended to use either client certificate or IAM for authentication.

  #### Rationale
  When disabled, you will still be able to authenticate to the cluster with client certificate or IAM. A client certificate is a base64-encoded public certificate used by clients to authenticate to the cluster endpoint. Disable client certificate generation to create a cluster without a client certificate.

  #### Remediation
  By default, Basic authentication is enabled when you create a new cluster. So manually disable it by setting the `master_auth.username` and `master_auth.password` to empty fields.

  Terraform example
  ```
  resource "google_container_cluster" "primary" {
      name               = "marcellus-wallace"
      location           = "us-central1-a"
      initial_node_count = 3

      master_auth {
  -     username = "abc"
  -     password = "xyz"
  +     username = ""
  +     password = ""

        client_certificate_config {
          issue_client_certificate = false
        }
      }
      ...
      ...
  }
  ```

  Using *Console*
    1. Go to [Kubernetes GCP Console](https://console.cloud.google.com/kubernetes/list)
    2. Select Kubernetes clusters for which Basic authentication is not used.
    3. Click on EDIT button and Set `Basic authentication` to `Disabled` under `Cluster` section.

  #### References
  * https://cloud.google.com/kubernetes-engine/docs/how-to/iam-integration
  * https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth
lwid:
  - GCP_CIS_7_10
  - GCP_K8S_1_10
provider: GCP
ruleId: CKV_GCP_19
severity: Medium
sid: ckv-gcp-19
title: Ensure GKE basic auth is disabled
