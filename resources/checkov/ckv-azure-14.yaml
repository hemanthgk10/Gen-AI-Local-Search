category: Encryption
checkTool: checkov
checkType: Terraform
compliance:
- CIS
- HIPAA
description: Ensure web app redirects all HTTP traffic to HTTPS in Azure App Service
extra:
  entity: Microsoft.Web/sites
  type: resource
guidelines: |-
  #### Description
  Azure Web Apps allows sites to run under both HTTP and HTTPS by default. Web apps can be accessed by anyone using non-secure HTTP links by default. Non-secure HTTP requests can be restricted and all HTTP requests redirected to the secure HTTPS port. It is recommended to enforce HTTPS-only traffic.

  #### Rationale
  Enabling HTTPS-only traffic will redirect all non-secure HTTP request to HTTPS ports. HTTPS uses the SSL/TLS protocol to provide a secure connection, which is both encrypted and authenticated. So it is important to support HTTPS for the security benefits.

  #### Impact
  When it is enabled, every incoming HTTP requests are redirected to the HTTPS port. It means an extra level of security will be added to the HTTP requests made to the app.

  #### Remediation
  Set the `azurerm_app_service.https_only` to `true`.

  Terraform example:
  ```
  resource "azurerm_app_service" "example" {
      name                = "example-app-service"
      location            = azurerm_resource_group.example.location
      resource_group_name = azurerm_resource_group.example.name
      app_service_plan_id = azurerm_app_service_plan.example.id

      site_config {
        dotnet_framework_version = "v4.0"
        scm_type                 = "LocalGit"
      }
  +   https_only          = true
      ...
      ...
  }
  ```

  Using Console:
    1. Login to Azure Portal using https://portal.azure.com
    2. Go to `App Services`
    3. Click on each App
    4. Under `Setting` section, Click on `SSL settings`
    5. Set `HTTPS Only` to On under `Protocol Settings` section

  Using Command Line:
  To set HTTPS-only traffic value for an existing app, run the following command:

  ```
   az webapp update --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> -- set httpsOnly=true
  ```

  By default, HTTPS-only feature will be disabled when a new app is created using the command-line tool or Azure Portal console.

  #### References
  * https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl#enforce-https
  * https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#https_only
lwid:
  - Azure_CIS_131_9_2
provider: Azure
ruleId: CKV_AZURE_14
severity: Critical
sid: ckv-azure-14
title: Ensure web app redirects all HTTP traffic to HTTPS in Azure App Service
