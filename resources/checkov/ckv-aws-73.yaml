---
category: Gateway
checkTool: checkov
checkType: CloudFormation
compliance: []
description: "Enabling x-ray tracing for AWS API Gateway helps in sending traces from gateway to x-ray automatically. Amazon API Gateway, instrumented with the X-Ray adds a tracing header with trace ID to all incoming requests. A trace collects all of the segments generated by a single request. When you enable X-Ray tracing on a stage, API Gateway creates a service-linked role in your account, if the role does not exist already. The role is named AWSServiceRoleForAPIGateway and will have the APIGatewayServiceRolePolicy managed policy attached to it."
extra:
  entity: "AWS::ApiGateway::Stage"
  type: resource
guidelines: |-
    #### Description
    Enabling x-ray tracing for AWS API Gateway helps in sending traces from gateway to x-ray automatically. Amazon API Gateway, instrumented with the X-Ray adds a tracing header with trace ID to all incoming requests. A trace collects all of the segments generated by a single request. When you enable X-Ray tracing on a stage, API Gateway creates a service-linked role in your account, if the role does not exist already. The role is named AWSServiceRoleForAPIGateway and will have the APIGatewayServiceRolePolicy managed policy attached to it.

    #### Rationale
    AWS x-ray tracing helps in visualizing the bottlenecks, components and failed requests of your application. On enabling x-ray for API gateway functions helps in sending trace data automatically to X-Ray. X-Ray processes the data to generate a service map and searchable trace summaries.

    #### Remediation
    Set the `xray_tracing_enabled` argument to `true`.

    Terraform example:
    ```
    resource "aws_api_gateway_stage" "example" {
        depends_on = [aws_cloudwatch_log_group.example]
        stage_name            = var.stage_name
    +   xray_tracing_enabled  = true
        ...
        ...
    }
    ```

    CloudFormation example:
    ```
    {
        "Type" : "AWS::ApiGateway::Stage",
        "Properties" : {
            "CacheClusterEnabled" : true,
            "CacheClusterSize" : String,
            "Description" : "Gateway example",
    +       "TracingEnabled" : true,
            "Variables" : { "environment" : "demo" }
        }
    }
    ```

    #### References
    * https://docs.amazonaws.cn/en_us/apigateway/latest/developerguide/apigateway-enabling-xray.html
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage#xray_tracing_enabled
    * https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-stage.html#cfn-apigateway-stage-tracingenabled
lwid: []
provider: AWS
ruleId: CKV_AWS_73
severity: Low
sid: ckv-aws-73
title: Ensure API Gateway has X-Ray Tracing enabled
autofix: true
remediation:
- checkType: Terraform
  steps:
  - action: add
    resource: [ "resource" ]
    resourceAttribute: xray_tracing_enabled
    resourceAttributeType: boolean
    resourceAttributeValue: "true"
    resourceType: [ "aws_api_gateway_stage" ]
