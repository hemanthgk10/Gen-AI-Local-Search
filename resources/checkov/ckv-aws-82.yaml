---
category: Storage
checkTool: checkov
checkType: Terraform
compliance: []
description: "Amazon Athena is an interactive query service that makes it easy to analyze data directly in Amazon Simple Storage Service (Amazon S3) using standard SQL. Athena Database uses the 256-bit Advanced Encryption Standard (AES-256) to encrypt your data using encryption keys stored in AWS Key Management Service (AWS KMS). AWS handles data encryption and decryption transparently with minimal impact on DB performance. While encrypting, we should also make sure that client is not able to disable the encryption."
extra:
  entity: aws_athena_workgroup
  type: resource
guidelines: |-
    #### Description
    Amazon Athena is an interactive query service that makes it easy to analyze data directly in Amazon Simple Storage Service (Amazon S3) using standard SQL. Athena Database uses the 256-bit Advanced Encryption Standard (AES-256) to encrypt your data using encryption keys stored in AWS Key Management Service (AWS KMS). AWS handles data encryption and decryption transparently with minimal impact on DB performance. While encrypting, we should also make sure that client is not able to disable the encryption.

    #### Rationale
    Ensure that AWS Athena is encrypted at rest for data security and in order to meet compliance requirements. The encrypted data includes your Athena query results in S3 bucket and the data in the AWS Glue Data Catalog. We don't want the client be able to disable the encyrption accidentally or purposefully by enabling a flag.

    #### Remediation
    Set the `configuration.enforce_workgroup_configuration` to true for enforcing configuration to prevent client from disabling the encryption.

    Terraform example:
    ```
    resource "aws_athena_workgroup" "example" {
        name = "example"

        configuration {
    +     enforce_workgroup_configuration    = true
          publish_cloudwatch_metrics_enabled = true
          result_configuration {
              output_location = "s3://${aws_s3_bucket.example.bucket}/output/"

              encryption_configuration {
                encryption_option = "SSE_KMS"
                kms_key_arn       = aws_kms_key.example.arn
              }
          }
          ...
          ...
        }
    }
    ```

    CloudFormation example:
    ```json

    {
        "Type" : "AWS::Athena::WorkGroup",
        "Properties" : {
            "Description" : "example for athena workgroup",
            "Name" : "example",
            "RecursiveDeleteOption" : true,
            "State" : String,
            "Tags" : [ Tag, ... ],
            "WorkGroupConfiguration" : {
    +           "EnforceWorkGroupConfiguration" : true,
                "PublishCloudWatchMetricsEnabled" : true,
                "RequesterPaysEnabled" : true,
            },
            ...
            ...
        }
    }
    ```

    #### References
    * https://docs.aws.amazon.com/athena/latest/ug/workgroups-settings.html
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#enforce_workgroup_configuration
lwid: []
provider: AWS
ruleId: CKV_AWS_82
severity: Medium
sid: ckv-aws-82
title: "Athena Workgroup should enforce configuration check"
autofix: true
remediation:
- checkType: Terraform
  steps:
  - action: add
    resource: [ "resource" ]
    resourceAttribute: configuration.enforce_workgroup_configuration
    resourceAttributeType: blockAttribute
    resourceAttributeValue: "true"
    resourceType: [ "aws_athena_workgroup" ]
