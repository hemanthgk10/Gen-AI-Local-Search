---
category: Security
checkTool: checkov
checkType: Terraform
compliance: []
description: "Integrity Monitoring provides active alerting for Shielded GKE nodes which allows administrators to respond to integrity failures and prevent compromised nodes from being deployed into the cluster."
extra:
  entity: google_container_cluster
  type: resource
guidelines: |-
    #### Description
    Integrity Monitoring provides active alerting for Shielded GKE nodes which allows administrators to respond to integrity failures and prevent compromised nodes from being deployed into the cluster.

    #### Rationale
    Enable Integrity Monitoring for Shielded GKE Nodes to be notified of inconsistencies during the node boot sequence.

    #### Remediation
    We shouldn't configure the `google_storage_bucket` logging to store in itself. Create a new bucket and configure that to store the logs of the bucket required.

    Terraform example
    ```
    resource "google_container_cluster" "example" {
        name                        = "my-gke-cluster"
        location                    = "us-central1"
        remove_default_node_pool    = true
        initial_node_count          = 1
        node_config {
          service_account = google_service_account.default.email
          shielded_instance_config {
    +       enable_integrity_monitoring  = true
            ...
            ...
          }
          ...
          ...
        }
        ...
        ...
    }

     OR

    resource "google_container_node_pool" "example_preemptible_nodes" {
        name       = "my-node-pool"
        location   = "us-central1"
        cluster    = google_container_cluster.primary.name
        node_config {
          preemptible  = true
          shielded_instance_config {
    +       enable_integrity_monitoring  = true
            ...
            ...
          }
          ...
          ...
        }
        ...
        ...
    }
    ```

    #### Default Value
    Integrity Monitoring is disabled by default on GKE clusters. Integrity Monitoring is enabled by default for Shielded GKE Nodes; however, if Secure Boot is enabled at creation time, Integrity Monitoring is disabled.

    #### Note
    You will also need to migrate workloads from existing non-conforming Node pools to the newly created Node pool, then delete the non-conforming pools.

    #### References
    * https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_integrity_monitoring
    * https://cloud.google.com/kubernetes-engine/docs/how-to/shielded-gke-nodes#system_integrity_monitoring
lwid: []
provider: GCP
ruleId: CKV_GCP_72
severity: Medium
sid: ckv-gcp-72
title: "Ensure Integrity Monitoring for Shielded GKE Nodes is Enabled"
