category: Big Data
checkTool: checkov
checkType: Terraform
compliance:
- CIS
- HIPAA
description: It is recommended that the IAM policy on BigQuery datasets does not allow
  anonymous and/or public access.
extra:
  entity: google_bigquery_dataset
  type: resource
guidelines: |-
  #### Description
  It is recommended that the IAM policy on BigQuery datasets does not allow anonymous and/or public access.

  #### Rationale
  Granting permissions to `allUsers` or `allAuthenticatedUsers` allows anyone to access the dataset. Such access might not be desirable if sensitive data is being stored in the dataset. Therefore, ensure that anonymous and/or public access to a dataset is not allowed.

  #### Remediation
  By default, BigQuery datasets are not publicly accessible. Do not set the `access.special_group` to `allAuthenticatedUsers` or `allUsers`.

  Only set the `user_by_email` or `group_by_email` or `domain` or `view`.

  Terraform example
  ```
  resource "google_bigquery_dataset" "dataset" {
      dataset_id                  = "example_dataset"
      friendly_name               = "test"
      description                 = "This is a test description"
      location                    = "US"
      default_table_expiration_ms = 3600000

      access {
  -      special_group  = "allAuthenticatedUsers"
  +      user_by_email  = ""
  +      group_by_email = ""
  +      domain         = ""
  +      view           = ""
      }
      ...
      ...
  }
  ```

  From *Console*
    1. Go to [BigQuery](https://console.cloud.google.com/bigquery)
    2. Select the dataset from `Resources`.
    3. Click `SHARE DATASET` near the right side of the window.
    4. Review each attached role.
    5. Click the delete icon for each member `allUsers` or `allAuthenticatedUsers`. On the popup click `Remove`.

  From *Command Line*

    1. Retrieve the data set information:
       ```
       bq show --format=prettyjson PROJECT_ID:DATASET_NAME > PATH_TO_FILE
       ```
    2. In the access section of the JSON file, update the dataset information to remove all roles containing `allUsers` or `allAuthenticatedUsers`.
    3. Update the dataset:
       ```
       bq update --source PATH_TO_FILE PROJECT_ID:DATASET_NAME
       ```

  #### Prevention
  You can prevent Bigquery dataset from becoming publicly accessible by setting up the Domain restricted sharing organization policy at:
  https://console.cloud.google.com/iam-admin/orgpolicies/iam-allowedPolicyMemberDomains

  #### Impact
  The dataset is not publicly accessible. Explicit modification of IAM privileges would be necessary to make them publicly accessible.

  #### References
  * https://cloud.google.com/bigquery/docs/dataset-access-controls
  * https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#special_group
lwid:
  - GCP_CIS12_7_1
provider: GCP
ruleId: CKV_GCP_15
severity: High
sid: ckv-gcp-15
title: Ensure that BigQuery datasets are not anonymously or publicly accessible
