category: Network
checkTool: checkov
checkType: CloudFormation
compliance:
- CIS
- HIPAA
description: Security groups provide stateful filtering of ingress/egress network
  traffic to AWS resources. It is recommended that no security group allows unrestricted
  ingress access to port 3389.
extra:
  entity: AWS::EC2::SecurityGroupIngress
  type: resource
guidelines: |-
  #### Description
  Security groups provide stateful filtering of ingress/egress network traffic to AWS resources. It is recommended that no security group allows unrestricted ingress access to port 3389. For updating an existing environment, care should be taken to ensure that administrators currently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or 3389 through another security group.

  #### Rationale
  Removing unfettered connectivity to remote console services, such as RDP, reduces a server's exposure to risk.

  #### Remediation
  A Port value of ALL or a port range such as 1024-4098 are inclusive of port 3389.

  Terraform example:
  ```
  resource "aws_security_group" "my-vpc" {
    vpc_id       = "vpc-1323"
    name         = "my-vpc"

    ingress {
      from_port   = 3389
      to_port     = 3389
      protocol    = "tcp"
  -   cidr_blocks = ["0.0.0.0/0"]
  +   cidr_blocks = ["10.0.0.1/32"]
    }

    egress {
      from_port   = 0
      to_port     = 0
      protocol    = "-1"
      cidr_blocks = ["0.0.0.0/0"]
    }
    ...
    ...
  }
  ```

  CloudFormation example:
  ```
  {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
          "GroupDescription" : "Security group to provide ingress for team A",
          "GroupName" : "teamA-ingress",
          "SecurityGroupIngress" : [ {
  -         "CidrIp" : "0.0.0.0/0",
  +         "CidrIp" : "192.168.10.0/24" // to a small range or known range
            "Description" : "Ingress rule to port 22 from anywhere",
            "FromPort" : "ALL",
            "IpProtocol" : "tcp",
            "ToPort" : 3389
          } ],
          "VpcId" : "vpc-12asf23e2"
        }
  }
  ```

  Manual Remediation:
    1. Login to the [AWS Management Console](https://console.aws.amazon.com/vpc/home)
    2. In the left pane, click Security Groups
    3. For each security group, perform the following:
    4. Select the security group
    5. Click the Inbound Rules tab
    6. Identify the rules to be removed
    7. Click the x in the Remove column
    8. Click Save

  #### References
  * https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules
  * https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group-ingress.html
lwid:
  - AWS_CIS_4_2
provider: AWS
ruleId: CKV_AWS_25
severity: Critical
sid: ckv-aws-25
title: Ensure no security groups allow ingress from 0.0.0.0:0 to port 3389
