---
category: Security
checkTool: checkov
checkType: Kubernetes
compliance:
  - CIS
description: |-
    Kubernetes is an open source platform for orchestrating containers. A container is a technology that lets you bundle and isolate applications with their entire runtime environment so that it’s easy to move the contained application between stages (development, production, etc.) and environments (on-premise, public cloud, private cloud, hybrid cloud, or multicloud) while retaining full functionality.

    The Kubernetes scheduler is a control plane process which assigns Pods to Nodes. The scheduler determines which Nodes are valid placements for each Pod in the scheduling queue according to constraints and available resources.

    Kubernetes scheduler has been instrumented and it exposes Prometheus metrics by default, providing information about the schedule requests etc, to the API. This endpoint can be easily scraped, obtaining all of this information without any calculation. This API endpoint is unauthenticated, so it is advised to bind this service to loopback secure address (localhost).
extra:
  entity: containers
  type: resource
guidelines: |-
    #### Description
    Kubernetes is an open source platform for orchestrating containers. A container is a technology that lets you bundle and isolate applications with their entire runtime environment so that it’s easy to move the contained application between stages (development, production, etc.) and environments (on-premise, public cloud, private cloud, hybrid cloud, or multicloud) while retaining full functionality.

    The Kubernetes scheduler is a control plane process which assigns Pods to Nodes. The scheduler determines which Nodes are valid placements for each Pod in the scheduling queue according to constraints and available resources.

    Kubernetes scheduler has been instrumented and it exposes Prometheus metrics by default, providing information about the schedule requests etc, to the API. This endpoint can be easily scraped, obtaining all of this information without any calculation. This API endpoint is unauthenticated, so it is advised to bind this service to loopback secure address (localhost).

    #### Rationale
    The Scheduler API service which runs on port 10251/TCP by default is used for health and metrics information and is available without authentication or encryption. As such it should only be bound to a localhost interface, to minimize the cluster's attack surface.

    #### Audit
    Run the following command on the master node:
    ```
     ps -ef | grep kube-scheduler
    ```
    Verify that the `--bind-address` argument is set to `127.0.0.1`.

    #### Remediation
    Edit the Scheduler pod specification file `/etc/kubernetes/manifests/kube-scheduler.yaml` file on the master node and ensure the correct value for the `--bind-address` parameter.

    By default, the `--bind-address` parameter is set to `0.0.0.0`.

    Example:
    ```yaml
      apiVersion: v1
      kind: Pod
      metadata:
        labels:
          component: kube-scheduler
          tier: control-plane
        name: kube-scheduler
        namespace: kube-system
      spec:
        containers:
        - command:
          - /usr/local/bin/kube-scheduler
          - --address=0.0.0.0
          - --leader-elect=false
    +     - --bind-address=0.0.0.0
            ...
            ...
          image: k8s.gcr.io/kube-scheduler:v1.9.7
          name: kube-scheduler
          volumeMounts:
          - mountPath: /var/ssl
            name: varssl
            readOnly: true
          - mountPath: /etc/openssl
            name: etcopenssl
            readOnly: true
          - mountPath: /etc/pki
            name: etcpki
            readOnly: true
        hostNetwork: true
        volumes:
        - hostPath:
            path: /var/ssl
          name: varssl
        - hostPath:
            path: /etc/openssl
          name: etcopenssl
        - hostPath:
            path: /etc/pki
          name: etcpki
        ...
        ...
    ```

    #### Impact
    Profiling information would not be available.

    #### CIS Controls:
    **Version 6**
      *9.1 Limit Open Ports, Protocols, and Services* -- Ensure that only ports, protocols, and services with validated business needs are running on each system.

    **Version 7**
      *9.2 Ensure Only Approved Ports, Protocols and Services Are Running* -- Ensure that only network ports, protocols, and services listening on a system with validated business needs, are running on each system.

    #### References
    * https://kubernetes.io/docs/admin/kube-scheduler/
    * https://kubernetes.io/docs/reference/command-line-tools-reference/kube-scheduler/
provider: Kubernetes
ruleId: CKV_K8S_115
severity: Low
sid: ckv-k8s-115
title: "Ensure that the --cert-file and --key-file arguments are set as appropriate"
