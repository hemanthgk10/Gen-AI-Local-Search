---
category: Storage
checkTool: checkov
checkType: Terraform
compliance: []
description: "Ensure Elasticsearch Domain Logging is enabled"
extra:
  entity: aws_elasticsearch_domain
  type: resource
guidelines: |-
    #### Description
    Amazon ElasticSearch is a fully managed service to help you run, deploy a secure ElasticSearch service cost effectively. ElasticSearch helps to store, analyze, and correlate application and infrastructure log data to find and fix issues faster and improve application performance. It is important to capture the errors and any failures in the logs for debugging. So ensure that logging is enabled.

    #### Rationale
    As ElasticSearch is a critical component in the application for acting as cache or store information that is critical to infrastructure, it is necessary to collect the information on the slow indexes, slow searches and application information bottlenecks. As it might contain sensitive information audit logs are also important.

    #### Remediation
    Set the block `log_publishing_options` with cloudwatch arn to send the logs and type of logs that needs to be sent.

    Valid `log_type` are:

    * INDEX_SLOW_LOGS
    * SEARCH_SLOW_LOGS
    * ES_APPLICATION_LOGS
    * AUDIT_LOGS

    Terraform example:
    ```
    resource "aws_elasticsearch_domain" "es" {
        domain_name           = var.domain
        elasticsearch_version = "6.3"

        cluster_config {
           instance_type = "m4.large.elasticsearch"
        }
    +   log_publishing_options {
    +      log_type                   = "INDEX_SLOW_LOGS"
    +      cloudwatch_log_group_arn   = "arn:aws:logs:us-east-1:123456789012:destination:example"
    +   }
        ...
        ...
    }
    ```

    CloudFormation example:
    ```json
    {
        "Type" : "AWS::Elasticsearch::Domain",
        "Properties" : {
            "DomainName" : "example.com",
            "DomainEndpointOptions" : {
               "EnforceHTTPS" : true,
               "TLSSecurityPolicy" : "Policy-Min-TLS-1-2-2019-07"
            },
    +       "LogPublishingOption" : {
    +         "AUDIT_LOGS": {
    +             "Enabled" : true
    +             "CloudWatchLogsLogGroupArn" : "arn:aws:logs:us-east-1:123456789012:destination:example"
    +         }
    +       }
            ...
            ...
        }
    }
    ```

    #### References
    * https://aws.amazon.com/blogs/big-data/viewing-amazon-elasticsearch-service-error-logs/
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#cloudwatch_log_group_arn
    * https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html#cfn-elasticsearch-domain-logpublishingoptions
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain
lwid: []
provider: AWS
ruleId: CKV_AWS_84
severity: Low
sid: ckv-aws-84
title: "Ensure Elasticsearch Domain Logging is enabled"
autofix: true
remediation:
- checkType: Terraform
  steps:
  - action: add
    resource: [ "resource" ]
    resourceAttribute: log_publishing_options
    resourceAttributeType: block
    resourceAttributeValue: |-
      log_publishing_options {
         log_type                   = "INDEX_SLOW_LOGS"
         enabled                    = true
         cloudwatch_log_group_arn   = "<Please provide the cloudwatch log group arn here>"
      }
    resourceType: [ "aws_elasticsearch_domain", "aws_opensearch_domain" ]
