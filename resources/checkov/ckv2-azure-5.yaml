---
category: Security
checkTool: checkov
checkType: Terraform
compliance:
  - CIS
description: "Ensure that VA setting 'Also send email notifications to admins and subscription owners' is set for a SQL server"
extra:
  entity: azurerm_sql_server
  type: resource
guidelines: |-
    #### Description
    Enable Vulnerability Assessment (VA) setting `Also send email notifications to admins and subscription owners`.

    #### Rationale
    VA scan reports and alerts will be sent to admins and subscription owners by enabling setting `Also send email notifications to admins and subscription owners`. This may help in reducing time required for identifying risks and taking corrective measures.

    #### Impact
    Enabling the `Azure Defender for SQL` features will incur additional costs for each SQL server.

    #### Remediation
    By default, 'email_subscription_admins' is set to `false`. Make sure to have it set to `true`.

    Terraform example
    ```
    resource "azurerm_mysql_server" "example" {
        name                         = "mysqlserver"
        version                      = "12.0"
        ...
        ...
    }

    resource "azurerm_storage_account" "example" {
        name                     = "storageaccountname"
        account_kind             = "StorageV2"
        account_tier             = "Standard"
        account_replication_type = "GRS"
        ...
        ...
    }

    resource "azurerm_mssql_server_security_alert_policy" "example" {
        server_name                = azurerm_mysql_server.example.name
        state                      = "Enabled"
        storage_endpoint           = azurerm_storage_account.example.primary_blob_endpoint
        storage_account_access_key = azurerm_storage_account.example.primary_access_key
        ...
        ...
    }

    resource "azurerm_mssql_server_vulnerability_assessment" "example" {
        server_security_alert_policy_id = azurerm_mssql_server_security_alert_policy.example.id
        storage_container_path          = "${azurerm_storage_account.example.primary_blob_endpoint}${azurerm_storage_container.example.name}/"
        storage_account_access_key      = azurerm_storage_account.example.primary_access_key

        recurring_scans {
          enabled                   = true
    +     email_subscription_admins = true
        }
        ...
        ...
    }
    ```

    #### References
    * https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment
    * https://docs.microsoft.com/en-us/rest/api/sql/servervulnerabilityassessments/listbyserver
    * https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Update-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0
    * https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Get-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0
    * https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessments
    * https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_vulnerability_assessment#email_subscription_admins
    * https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy
    * https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server
lwid:
  - Azure_CIS_131_4_2_5
provider: Azure
ruleId: CKV2_AZURE_5
severity: Low
sid: ckv2-azure-5
title: "Ensure that VA setting 'Also send email notifications to admins and subscription owners' is set for a SQL server"
