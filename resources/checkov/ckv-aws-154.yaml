---
category: Network
checkTool: checkov
checkType: Terraform
compliance: []
description: |-
    Amazon Redshift is a fully managed, petabyte-scale data warehouse service in the cloud. After you provision your cluster, you can upload your data set and then perform data analysis queries. Regardless of the size of the data set, Amazon Redshift offers fast query performance using the same SQL-based tools and business intelligence applications that you use today.

    You can create a cluster subnet group if you are provisioning your cluster in your virtual private cloud (VPC). Your VPC can have one or more subnets, a subset of IP addresses within your VPC, that enable you to group your resources based on your security and operation needs. A cluster subnet group allows you to specify a set of subnets in your VPC. When provisioning a cluster you provide the subnet group and Amazon Redshift creates the cluster on one of the subnets in the group.
extra:
  entity: aws_redshift_cluster
  type: resource
guidelines: |-
    #### Description
    Amazon Redshift is a fully managed, petabyte-scale data warehouse service in the cloud. After you provision your cluster, you can upload your data set and then perform data analysis queries. Regardless of the size of the data set, Amazon Redshift offers fast query performance using the same SQL-based tools and business intelligence applications that you use today.

    You can create a cluster subnet group if you are provisioning your cluster in your virtual private cloud (VPC). Your VPC can have one or more subnets, a subset of IP addresses within your VPC, that enable you to group your resources based on your security and operation needs. A cluster subnet group allows you to specify a set of subnets in your VPC. When provisioning a cluster you provide the subnet group and Amazon Redshift creates the cluster on one of the subnets in the group.

    #### Rationale
    Deploying a AWS Redshift Cluster outside a VPC will make this public and also not provide access to the other AWS VPC resources that are private. Any sensitive information exchanged between the AWS Redshift cluster and other private resources in AWS VPC can be open to man-in-the-middle attack.

    #### Remediation
    If this `cluster_subnet_group_name` parameter is not provided the resulting cluster will be deployed outside virtual private cloud (VPC).

    Terraform example:
    ```
    resource "aws_redshift_cluster" "default" {
        cluster_identifier        = "tf-redshift-cluster"
        database_name             = "mydb"
        master_username           = "foo"
        master_password           = "Mustbe8characters"
        node_type                 = "dc1.large"
        cluster_type              = "single-node"
    +   cluster_subnet_group_name = "my-cluster-group"
        ...
        ...
    }
    ```

    CloudFormation example:
    ```json
    {
        "Type" : "AWS::Redshift::Cluster",
        "Properties" : {
            "AllowVersionUpgrade" : true,
            "ClusterIdentifier" : "tf-redshift-cluster"
            "DBName" : "mydb",
    +       "ClusterSubnetGroupName" : "my-cluster-group"
            ...
            ...
        }
    }
    ```

    Using *Console*:
    1. Sign in to the [AWS Redshift console](https://console.aws.amazon.com/redshift/).
    2. On the navigation menu, choose `CONFIG`, then choose `Subnet groups`. The list of subnet groups is displayed.
    3. Choose `Create cluster subnet group` to display the create page.
    4. Enter information for the subnet group, including which subnets to add.
    5. Choose `Create cluster subnet group` to create the group with the subnets that you chose.

    #### References
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#cluster_subnet_group_name
lwid: []
provider: AWS
ruleId: CKV_AWS_154
severity: High
sid: ckv-aws-154
title: "Ensure Redshift is not deployed outside of a VPC"
