category: Gateway
checkTool: checkov
checkType: Terraform
compliance: []
description: AWS API gateway acts as an entry point for applications to access data,
  business logic or functionality of your application backend. It handles the all
  the API calls to your backend application including traffic management, CORS, authorization
  and access control, throttling, monitoring, and API version management. When exposing
  this entry point, we should make sure that our backend is not exposed through it.
  So ensure there is no open access to back-end resources through API.
extra:
  entity: aws_api_gateway_method
  type: resource
guidelines: |-
  #### Description
  AWS API gateway acts as an entry point for applications to access data, business logic or functionality of your application backend. It handles the all the API calls to your backend application including traffic management, CORS, authorization and access control, throttling, monitoring, and API version management. When exposing this entry point, we should make sure that our backend is not exposed through it. So ensure there is no open access to back-end resources through API.

  #### Rationale
  AWS API gateway is the front-door to our application. Having an insecure front door can allow intruders to easily access the backend of our application and leak sensitive information. So we ensure that we set the right options to secure it correctly.

  #### Remediation
  When `http_method` is set to anything other than `OPTIONS` then make sure `authorization` is not set to `NONE`.

  Terraform example:
  ```
  resource "aws_api_gateway_method" "MyDemoMethod" {
     rest_api_id   = aws_api_gateway_rest_api.MyDemoAPI.id
     resource_id   = aws_api_gateway_resource.MyDemoResource.id
     http_method   = "GET"
  -  authorization = "NONE"
  +  authorization = "AWS_IAM"
     ...
     ...
  }
  ```

  CloudFormation example:
  ```json
  {
    "Type" : "AWS::ApiGateway::Method",
    "Properties" : {
        "ApiKeyRequired" : true,
  -     "AuthorizationType" : "NONE",
  +     "AuthorizationType" : "GET"
        "HttpMethod" : "GET",
      }
  }
  ```

  #### References
  * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method#authorization
  * https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-method-settings.html
lwid: []
provider: AWS
ruleId: CKV_AWS_59
severity: Medium
sid: ckv-aws-59
title: Ensure there is no open access to back-end resources through API
autofix: true
remediation:
- checkType: Terraform
  steps:
  - action: add
    resource: [ "resource" ]
    resourceAttribute: authorization
    resourceAttributeType: string
    resourceAttributeValue: "AWS_IAM"
    resourceType: [ "aws_api_gateway_method" ]
