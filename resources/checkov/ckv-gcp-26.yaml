category: VPC
checkTool: checkov
checkType: Terraform
compliance:
- CIS
- HIPAA
description: Ensure that VPC Flow Logs is enabled for every subnet in a VPC Network
extra:
  entity: google_compute_subnetwork
  type: resource
guidelines: |-
  #### Description
  Flow Logs is a feature that enables you to capture information about the IP traffic going to and from network interfaces in your VPC Subnets. After you've created a flow log, you can view and retrieve its data in Stackdriver Logging. It is recommended that Flow Logs be enabled for every business critical VPC subnet.

  #### Rationale
  VPC networks and subnetworks provide logically isolated and secure network partitions where you can launch GCP resources. When Flow Logs is enabled for a subnet, VMs within subnet starts reporting on all TCP and UDP flows. Each VM samples the TCP and UDP flows it sees, inbound and outbound, whether the flow is to or from another VM, a host in your on-premises datacenter, a Google service, or a host on the Internet. If two GCP VMs are communicating, and both are in subnets that have VPC Flow Logs enabled, both VMs report the flows.

  Flow Logs supports following use cases:
    * Network monitoring
    * Understanding network usage and optimizing network traffic expenses
    * Network forensics
    * Real-time security analysis

  Flow Logs provide visibility into network traffic for each VM inside the subnet and can be used to detect anomalous traffic or insight during security workflows.

  #### Remediation
  By default, Flow Logs is set to `Off` when you create a new VPC network subnet. So set the `log_config` block in `google_compute_subnetwork`.

  Terraform example
  ```
  resource "google_compute_subnetwork" "subnet-with-logging" {
       name          = "log-test-subnetwork"
       ip_cidr_range = "10.2.0.0/16"
       region        = "us-central1"
       network       = google_compute_network.custom-test.id

  +    log_config {
  +      aggregation_interval = "INTERVAL_10_MIN"
  +      flow_sampling        = 0.5
  +      metadata             = "INCLUDE_ALL_METADATA"
  +    }
       ...
       ...
  }
  ```

  Using *Console*
    1. Go to [VPC network GCP Console](https://console.cloud.google.com/networking/networks/list)
    2. Click the name of a subnet, The `Subnet details` page is displayed.
    3. Click on `EDIT` button.
    4. Set `Flow Logs` to `On`.
    5. Click on `Save`.

  Using *Command Line*

  To set Private Google access for an network subnets, run the following command
  ```
  gcloud compute networks subnets update [SUBNET_NAME] --region [REGION] --enable-flow-logs
  ```

  #### Impact
  Standard pricing for Stackdriver Logging, BigQuery, or Cloud Pub/Sub apply. VPC flow logs generation will be charged starting in GA as described in reference:
  https://cloud.google.com/vpc/

  #### References
  * https://cloud.google.com/vpc/docs/using-flow-logs#enabling_vpc_flow_logging
  * https://cloud.google.com/vpc/
  * https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork#log_config
lwid:
  - GCP_CIS12_3_8
provider: GCP
ruleId: CKV_GCP_26
severity: Low
sid: ckv-gcp-26
title: Ensure that VPC Flow Logs is enabled for every subnet in a VPC Network
