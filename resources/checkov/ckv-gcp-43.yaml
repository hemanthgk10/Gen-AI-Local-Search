category: Encryption
checkTool: checkov
checkType: Terraform
compliance:
- CIS
description: Ensure KMS encryption keys are rotated within a period of 90 days
extra:
  entity: google_kms_crypto_key
  type: resource
guidelines: |-
  #### Description
  Google Cloud Key Management Service stores cryptographic keys in a hierarchical structure designed for useful and elegant access control management.

  The format for the rotation schedule depends on the client library that is used. For the gcloud command-line tool, the next rotation time must be in `ISO` or `RFC3339` format, and the rotation period must be in the form `INTEGER[UNIT]`, where units can be one of seconds (s), minutes (m), hours (h) or days (d).

  #### Rationale
  Set a key rotation period and starting time. A key can be created with a specified `rotation period`, which is the time between when new key versions are generated automatically. A key can also be created with a specified next rotation time. A key is a named object representing a `cryptographic key` used for a specific purpose. The key material, the actual bits used for `encryption`, can change over time as new key versions are created.

  A key is used to protect some `corpus of data`. A collection of files could be encrypted with the same key and people with `decrypt` permissions on that key would be able to decrypt those files. Therefore, it's necessary to make sure the `rotation period` is set to a specific time.

  #### Remediation
  By default, KMS encryption keys are rotated every 90 days.

  Terraform example
  ```
  resource "google_kms_crypto_key" "example-key" {
      name            = "crypto-key-example"
      key_ring        = google_kms_key_ring.keyring.id

  -   rotation_period = "100000s"
  +   # 90 days in seconds
  +   rotation_period = "7776000s"

      ...
      ...
  }
  ```

  Using *Console*
  1. Go to [Cryptographic Keys](https://console.cloud.google.com/security/kms)
  2. Click on the specific key ring.
  3. From the list of keys, choose the specific key and Click on `Right side pop up the blade (3 dots)`.
  4. Click on `Edit rotation period`.
  5. On the pop-up window, `Select a new rotation period` in days which should be less than 90 and then choose `Starting on` date (date from which the rotation period begins).

  #### Impact
  After a successful key rotation, the older key version is required in order to decrypt the data encrypted by that previous key version.

  #### References
  * https://cloud.google.com/kms/docs/key-rotation#frequency_of_key_rotation
  * https://cloud.google.com/kms/docs/re-encrypt-data
  * https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_crypto_key#rotation_period

  #### Notes
  * Key rotation does NOT re-encrypt already encrypted data with the newly generated key version. If you suspect unauthorized use of a key, you should re-encrypt the data protected by that key and then disable or schedule destruction of the prior key version.
  * It is not recommended to rely solely on irregular rotation, but rather to use irregular rotation if needed in conjunction with a regular rotation schedule.
lwid:
  - GCP_CIS12_1_10
provider: GCP
ruleId: CKV_GCP_43
severity: Low
sid: ckv-gcp-43
title: Ensure KMS encryption keys are rotated within a period of 90 days
