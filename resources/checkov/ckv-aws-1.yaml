category: IAM
checkTool: checkov
checkType: Terraform
compliance:
- CIS
description: Prevent the creation of IAM policies that allow blanket administrative
  privileges.
extra:
  entity: serverless_aws
  type: resource
guidelines: |-
  ##### Description
  Ensure IAM policies don't allow blanket administrative privileges. IAM policies should be created with both explicit and minimal privileges.

  ##### Rationale
  Using administrative privileges when not necessary creates the potential for abuse by an attacker, who may exploit the over-privileged policy to perform malicious actions.

  ##### Remediation
  Manual Steps:
  1. Navigate to [Identity and Access Management][iam-console]
  2. In the left navigation, select Policies.
  3. Select the Policy and edit the document to define only the explicit permissions necessary for the role.
  4. Repeat for each policy that allows for Allow and Action set to `*` and Resource set to `*`.

  Terraform example:
  ```
  data "aws_iam_policy_document" "example" {
    statement {
      sid = "1"

  -   actions = [ "*"]

  +   actions = [
  +     "s3:ListAllMyBuckets",
  +     "s3:GetBucketLocation",
  +   ]

  -   resources = [ "*" ]

  +   resources = [
  +     "arn:aws:s3:::${var.s3_bucket_name}",
  +   ]
    }
  }

  resource "aws_iam_policy" "example" {
    name   = "example_policy"
    path   = "/"
    policy = data.aws_iam_policy_document.example.json
  }
  ```

  CloudFormation example:
  ```
  {
    "Type" : "AWS::IAM::Policy",
    "Properties" : {
      "PolicyDocument" : {
        "Version": "2020-10-17",
        "Statement": [
            {
                "Sid": "AllowAllUsersToListAccounts",
                "Effect": "Allow",
  -             "Action": "*",
  +             "Action": [
  +                 "s3:ListAllMyBuckets",
  +                 "s3:GetBucketLocation"
  +              ],
                ...
                ...
  -             "Resource": "*"
  +             "Resource": [
  +                "arn:aws:s3:::my_corporate_bucket/example.png"
  +             ]
            }
        ]
      },
      "PolicyName" : "s3-default-bucket-policy",
      ...
      ...
    }
  }
  ```

  ##### References
  * https://docs.aws.amazon.com/IAM/latest/UserGuide/access_controlling.html
  * https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html
  * https://learn.hashicorp.com/terraform/aws/iam-policy
  * https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-policy.html

  [iam-console]: https://console.aws.amazon.com/iam/
lwid:
  - AWS_CIS_1_24
provider: AWS
ruleId: CKV_AWS_1
severity: Critical
sid: ckv-aws-1
title: IAM policies shouldn't allow blanket administrative privileges
