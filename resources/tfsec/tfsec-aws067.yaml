---
autofix: true
category: Encryption
checkTool: tfsec
checkType: Terraform
compliance: []
description: |-
    Amazon Elastic Kubernetes Service (Amazon EKS) is a managed service that you can use to run Kubernetes on AWS without needing to install, operate, and maintain your own Kubernetes control plane or nodes. Kubernetes is an open-source system for automating the deployment, scaling, and management of containerized applications.

    The control plane consists of at least two API server instances and three etcd instances that run across three Availability Zones within a Region. It is important to monitor the activity of the API servers for auditing purposes, so we should enable the logs for the control plane.
extra:
  srcUrl: "https://github.com/tfsec/tfsec/blob/master/internal/app/tfsec/checks/aws067.go"
guidelines: |-
    #### Description
    Amazon Elastic Kubernetes Service (Amazon EKS) is a managed service that you can use to run Kubernetes on AWS without needing to install, operate, and maintain your own Kubernetes control plane or nodes. Kubernetes is an open-source system for automating the deployment, scaling, and management of containerized applications.

    The control plane consists of at least two API server instances and three etcd instances that run across three Availability Zones within a Region. It is important to monitor the activity of the API servers for auditing purposes, so we should enable the logs for the control plane.

    #### Rationale
    By default cluster control plane logging is not turned on. Amazon EKS control plane logging provides audit and diagnostic logs directly from the Amazon EKS control plane to CloudWatch Logs in your account. These logs make it easy for you to secure and run your clusters.

    #### Remediation
    Logging is available for audit, api, authenticator, controllerManager and scheduler. All logging should be turned on for cluster control plane.

    Terraform example:
    ```
    resource "aws_eks_cluster" "example" {
        name     = "example"
        role_arn = aws_iam_role.example.arn
        vpc_config {
          subnet_ids = [aws_subnet.example1.id, aws_subnet.example2.id]
        }
        encryption_config {
          provider {
              key_arn = var.kms_arn
          }
          resources  = [ "secrets" ]
        }
    +   enabled_cluster_log_types = ["api", "authenticator", "audit", "scheduler", "controllerManager"]
        ...
        ...
    }
    ```

    #### References
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#enabled_cluster_log_types
    * https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html
lwid: []
provider: AWS
remediation:
  -
    checkType: Terraform
    steps:
      -
        action: add
        resource:
          - resource
        resourceAttribute: enabled_cluster_log_types
        resourceAttributeType: array
        resourceAttributeValue: "api,authenticator,audit,scheduler,controllerManager"
        resourceType:
          - aws_eks_cluster
ruleId: AWS067
severity: Low
sid: tfsec-aws067
title: "EKS Clusters should have cluster control plane logging turned on"
