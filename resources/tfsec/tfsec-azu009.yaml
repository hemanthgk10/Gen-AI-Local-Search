---
autofix: true
category: Logging
checkTool: tfsec
checkType: Terraform
compliance: []
description: "Ensure AKS logging to Azure Monitoring is configured for containers to monitor the performance of workloads."
extra:
  srcUrl: "https://github.com/tfsec/tfsec/blob/master/internal/app/tfsec/checks/azu009.go"
guidelines: |-
    #### Description
    Azure AKS is a managed Kubernetes cluster service from Microsoft. AKS operationalize your workload containers on Kubernetes.

    Logging is an essential way to monitor the performance of your workloads that are deployed to Kubernetes environments.

    #### Rationale
    AKS logs contains detailed information about successful and failed requests to the AKS cluster. This information can be used to monitor individual requests and to diagnose issues with any workload.

    #### Remediation
    Set the `addon_profile.oms_agent` to `true`.

    Terraform example for Azure Kubernetes cluster
    ```
    resource "azurerm_kubernetes_cluster" "example" {
        name                = "example-aks1"
        location            = azurerm_resource_group.example.location
        resource_group_name = azurerm_resource_group.example.name
        dns_prefix          = "exampleaks1"

        default_node_pool {
          name       = "default"
          node_count = 1
          vm_size    = "Standard_D2_v2"
        }

    +   addon_profile {
    +     oms_agent = true
    +   }
        ...
        ...
    }
    ```

    #### References
    * https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#addon_profile
    * https://docs.microsoft.com/en-us/azure/monitoring/monitoring-container-insights-onboard
lwid: []
provider: Azure
remediation:
  -
    checkType: Terraform
    steps:
      -
        action: modify
        resource:
          - resource
        resourceAttribute: addon_profile
        resourceAttributeType: block
        resourceAttributeValue: |-
            addon_profile {
               oms_agent = true
            }
        resourceType:
          - azurerm_kubernetes_cluster
ruleId: AZU009
severity: Low
sid: tfsec-azu009
title: "Ensure AKS logging to Azure Monitoring is Configured"
