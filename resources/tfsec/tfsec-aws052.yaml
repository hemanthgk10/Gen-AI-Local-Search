---
autofix: true
category: Encryption
checkTool: tfsec
checkType: Terraform
compliance:
  - HIPAA
description: "Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id."
extra:
  srcUrl: "https://github.com/tfsec/tfsec/blob/master/internal/app/tfsec/checks/aws052.go"
guidelines: |-
    #### Description
    Ensure that RDS database instances are encrypted to fulfill compliance requirements for data-at-rest encryption. The RDS data encryption and decryption is handled transparently and donâ€™t require any additional action from you or your application, you just need to select the Master Key which is going to encrypt the instance.

    To enable data encryption for an existing RDS instance you need to re-create it (back-up and restore) with encryption flag enabled.

    #### Rationale
    Native RDS encryption helps protect your cloud applications and fulfils compliance requirements for data-at-rest encryption.

    #### Remediation
    Set `storage_encrypted` flag as true. When `storage_encrypted` is set, then we should also provide `kms_key_id`.

    Terraform example
    ```
    resource "aws_db_instance" "mydb" {
        allocated_storage    = 30
        storage_type         = "gp2"
        engine               = "mysql"
        engine_version       = "5.7"
        instance_class       = "db.t2.medium"
        name                 = "mydb"
    +   storage_encrypted    = true
    +   kms_key_id           = "arn:aws:kms:us-west-2:111122223333:key/xyz"
        ...
        ...
    }
    ```

    #### References
    * https://aws.amazon.com/rds/features/security/
    * https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#storage_encrypted
    * https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#kms_key_id
lwid: []
provider: AWS
remediation:
  -
    checkType: Terraform
    steps:
      -
        action: add
        resource:
          - resource
        resourceAttribute: storage_encrypted
        resourceAttributeType: boolean
        resourceAttributeValue: "true"
        resourceType:
          - aws_db_instance
      -
        action: add
        resource:
          - resource
        resourceAttribute: kms_key_id
        resourceAttributeType: string
        resourceAttributeValue: "<Provide the ARN of the KMS key>"
        resourceType:
          - aws_db_instance
ruleId: AWS052
severity: Medium
sid: tfsec-aws052
title: "RDS encryption has not been enabled at a DB Instance level"
